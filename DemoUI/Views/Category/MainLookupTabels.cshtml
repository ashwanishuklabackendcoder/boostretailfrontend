@{
    ViewData["Title"] = "Maintain Lookup Tables";
}

<div class="container-fluid px-0">
    <h4 class="fw-bold mb-2">CATEGORIZATION</h4>
    <p class="text-muted">Maintain Lookup Tables</p>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h6 class="mb-0">Create Lookup Tables</h6>
        <button class="btn btn-primary btn-sm"><i class="fa fa-plus"></i></button>
    </div>
</div>
<div class="lookup-tables-container">
    <div class="card">
        <div class="card-body p-0">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th class="p-3 sortable">Table Name <i class="fa-solid fa-sort ms-1"></i></th>
                        <th class="p-3">Supplier Feed</th>
                        <th class="p-3 sortable">Columns <i class="fa-solid fa-sort ms-1"></i></th>
                        <th class="p-3 sortable">Categorization <i class="fa-solid fa-sort ms-1"></i></th>
                        <th class="p-3">Active</th>
                        <th class="p-3">Action</th>
                    </tr>
                </thead>
                <tbody id="lookup-table-body">
                    <tr>
                        <td colspan="6" class="text-center p-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        $(document).ready(function() {
            const apiUrl = "https://simapi.runasp.net/api/Category/GetCategoryLookups";
            const tableBody = $('#lookup-table-body');

            // Based on your design, we map supplier IDs to names.
            // You might get this from another API call in a real application.
            const supplierMap = {
                3: 'Giant',
                4: 'Haibike',
                5: 'Lapierre'
            };

            fetch(apiUrl)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Clear the loading spinner
                    tableBody.empty();

                    // Update the count in the header
                    $('#lookup-table-count').text(`Lookup Tables: ${data.length}`);

                    if (data.length === 0) {
                        tableBody.html('<tr><td colspan="6" class="text-center p-4">No lookup tables found.</td></tr>');
                        return;
                    }

                    // Loop through the data and build table rows
                    data.forEach(item => {
                        const supplierName = supplierMap[item.supplierFeed] || 'Unknown';
                        const isChecked = item.isActive ? 'checked' : '';

                        const rowHtml = `
                            <tr data-id="${item.id}">
                                <td class="p-3">${item.tableName}</td>
                                <td class="p-3">${supplierName}</td>
                                <td class="p-3">${item.supplierColumns}</td>
                                <td class="p-3">${item.categorisation}</td>
                                <td class="p-3">
                                    <input class="form-check-input" type="checkbox" ${isChecked} disabled>
                                </td>
                                <td class="p-3 action-icons">
                                    <a href="#" title="Edit"><i class="fa-solid fa-pen"></i></a>
                                    <a href="#" title="Delete"><i class="fa-solid fa-trash-can"></i></a>
                                </td>
                            </tr>
                        `;
                        tableBody.append(rowHtml);
                    });
                })
                .catch(error => {
                    console.error('Error fetching lookup tables:', error);
                    tableBody.html('<tr><td colspan="6" class="text-center p-4 text-danger">Failed to load data. Please try again later.</td></tr>');
                });
        });
    </script>
}